# Extract sapling transition tables

# Pulling trees

``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
source(here::here("R", "query_saplings.R"))

con <- connect_to_tables(here::here("data", "db", "foresttime-to-share.duckdb"))
```

``` r
saplings_mn <- query_saplings(con, 
                              conditions = create_conditions(
                                STATECD == 27
                              ))
```

    Joining with `by = join_by(PLOT_COMPOSITE_ID, INVYR)`

``` r
knitr::kable(head(saplings_mn, 40))
```

| PLOT_COMPOSITE_ID |  PLOT | COUNTYCD | STATECD |       PLT_CN | INVYR | PREV_INVYR | CYCLE | live_sapling | new_sapling | sapling_sapling | sapling_tree | sapling_dead | sapling_removed | sapling_not_sampled | sapling_missing_data | sapling_vanishes_next_year | PREV_live_sapling | sapling_vanished | presumed_dead | timespan | sapling_sapling_prop | sapling_tree_prop | sapling_removed_prop | presumed_dead_prop | sapling_not_sampled_prop | sapling_missing_data_prop |
|:------------------|------:|---------:|--------:|-------------:|------:|-----------:|------:|-------------:|------------:|----------------:|-------------:|-------------:|----------------:|--------------------:|---------------------:|---------------------------:|------------------:|-----------------:|--------------:|---------:|---------------------:|------------------:|---------------------:|-------------------:|-------------------------:|--------------------------:|
| 27_1_137_20237    | 20237 |      137 |      27 | 1.691059e+14 |  2010 |       2005 |    14 |            1 |           0 |               1 |            0 |            9 |               0 |                   0 |                    0 |                          0 |                10 |                0 |             9 |        5 |            0.1000000 |         0.0000000 |                    0 |          0.9000000 |                0.0000000 |                         0 |
| 27_1_137_20237    | 20237 |      137 |      27 | 6.105556e+14 |  2020 |       2015 |    16 |            4 |           3 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          4 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_25749    | 25749 |      137 |      27 | 1.024536e+14 |  2006 |       2001 |    13 |            6 |           1 |               5 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 5 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_25749    | 25749 |      137 |      27 | 2.213455e+14 |  2011 |       2006 |    14 |            5 |           0 |               5 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             1 |        5 |            0.8333333 |         0.0000000 |                    0 |          0.1666667 |                0.0000000 |                         0 |
| 27_1_137_25749    | 25749 |      137 |      27 | 3.001613e+14 |  2016 |       2011 |    15 |            0 |           0 |               0 |            0 |            0 |               0 |                   5 |                    0 |                          0 |                 5 |                0 |             0 |        5 |            0.0000000 |         0.0000000 |                    0 |          0.0000000 |                1.0000000 |                         0 |
| 27_1_137_25749    | 25749 |      137 |      27 | 7.218257e+14 |  2021 |       2016 |    16 |           12 |          12 |               0 |            0 |            0 |               0 |                   0 |                    0 |                         12 |                 0 |                0 |             0 |        5 |                   NA |                NA |                   NA |                 NA |                       NA |                        NA |
| 27_1_137_26541    | 26541 |      137 |      27 | 1.021436e+14 |  2008 |       2003 |    13 |           10 |           1 |               9 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                10 |                0 |             1 |        5 |            0.9000000 |         0.0000000 |                    0 |          0.1000000 |                0.0000000 |                         0 |
| 27_1_137_26541    | 26541 |      137 |      27 | 1.574014e+13 |  2013 |       2008 |    14 |            8 |           0 |               8 |            0 |            2 |               0 |                   0 |                    0 |                          0 |                10 |                0 |             2 |        5 |            0.8000000 |         0.0000000 |                    0 |          0.2000000 |                0.0000000 |                         0 |
| 27_1_137_26541    | 26541 |      137 |      27 | 4.490725e+14 |  2018 |       2013 |    15 |            6 |           1 |               5 |            1 |            2 |               0 |                   0 |                    0 |                          6 |                 8 |                0 |             2 |        5 |            0.6250000 |         0.1250000 |                    0 |          0.2500000 |                0.0000000 |                         0 |
| 27_1_137_26562    | 26562 |      137 |      27 | 1.024586e+14 |  2006 |       2001 |    13 |           19 |           7 |              12 |            0 |            2 |               0 |                   0 |                    0 |                          0 |                14 |                0 |             2 |        5 |            0.8571429 |         0.0000000 |                    0 |          0.1428571 |                0.0000000 |                         0 |
| 27_1_137_26562    | 26562 |      137 |      27 | 2.213470e+14 |  2011 |       2006 |    14 |           13 |           0 |              13 |            2 |            4 |               0 |                   0 |                    0 |                          0 |                19 |                0 |             4 |        5 |            0.6842105 |         0.1052632 |                    0 |          0.2105263 |                0.0000000 |                         0 |
| 27_1_137_26562    | 26562 |      137 |      27 | 3.001618e+14 |  2016 |       2011 |    15 |            4 |           0 |               4 |            1 |            7 |               0 |                   1 |                    0 |                          0 |                13 |                0 |             7 |        5 |            0.3076923 |         0.0769231 |                    0 |          0.5384615 |                0.0769231 |                         0 |
| 27_1_137_26562    | 26562 |      137 |      27 | 7.218262e+14 |  2021 |       2016 |    16 |            2 |           0 |               2 |            2 |            0 |               0 |                   0 |                    0 |                          2 |                 4 |                0 |             0 |        5 |            0.5000000 |         0.5000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_26838    | 26838 |      137 |      27 | 1.574014e+13 |  2013 |       2008 |    14 |           12 |          11 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_26838    | 26838 |      137 |      27 | 4.490725e+14 |  2018 |       2013 |    15 |           19 |           7 |              12 |            0 |            0 |               0 |                   0 |                    0 |                         19 |                12 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_27328    | 27328 |      137 |      27 | 1.021442e+14 |  2008 |       2003 |    13 |           29 |           2 |              27 |            2 |            5 |               0 |                   0 |                    0 |                          0 |                56 |               22 |            27 |        5 |            0.4821429 |         0.0357143 |                    0 |          0.4821429 |                0.0000000 |                         0 |
| 27_1_137_27328    | 27328 |      137 |      27 | 1.574030e+13 |  2013 |       2008 |    14 |           25 |           3 |              22 |            2 |            5 |               0 |                   0 |                    0 |                          0 |                29 |                0 |             5 |        5 |            0.7586207 |         0.0689655 |                    0 |          0.1724138 |                0.0000000 |                         0 |
| 27_1_137_28629    | 28629 |      137 |      27 | 9.926024e+13 |  2005 |       2000 |    13 |            7 |           0 |               7 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 7 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_28629    | 28629 |      137 |      27 | 1.691019e+14 |  2010 |       2005 |    14 |            8 |           1 |               7 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 7 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_28629    | 28629 |      137 |      27 | 2.317348e+14 |  2015 |       2010 |    15 |            9 |           1 |               8 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 8 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_28629    | 28629 |      137 |      27 | 6.105527e+14 |  2020 |       2015 |    16 |            9 |           0 |               9 |            0 |            0 |               0 |                   0 |                    0 |                          9 |                 9 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_137_29081    | 29081 |      137 |      27 | 6.105550e+14 |  2020 |       2015 |    16 |            0 |           0 |               0 |            0 |            0 |               0 |                   6 |                    0 |                          0 |                 6 |                0 |             0 |        5 |            0.0000000 |         0.0000000 |                    0 |          0.0000000 |                1.0000000 |                         0 |
| 27_1_31_21052     | 21052 |       31 |      27 | 1.691015e+14 |  2010 |       2005 |    14 |           18 |           4 |              14 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                15 |                0 |             1 |        5 |            0.9333333 |         0.0000000 |                    0 |          0.0666667 |                0.0000000 |                         0 |
| 27_1_31_21052     | 21052 |       31 |      27 | 2.317353e+14 |  2015 |       2010 |    15 |           29 |          12 |              17 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                18 |                0 |             1 |        5 |            0.9444444 |         0.0000000 |                    0 |          0.0555556 |                0.0000000 |                         0 |
| 27_1_31_29350     | 29350 |       31 |      27 | 3.001613e+14 |  2016 |       2011 |    15 |            5 |           0 |               5 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             1 |        5 |            0.8333333 |         0.0000000 |                    0 |          0.1666667 |                0.0000000 |                         0 |
| 27_1_31_29350     | 29350 |       31 |      27 | 7.218257e+14 |  2021 |       2016 |    16 |            5 |           1 |               4 |            1 |            0 |               0 |                   0 |                    0 |                          5 |                 5 |                0 |             0 |        5 |            0.8000000 |         0.2000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_71_20250     | 20250 |       71 |      27 | 1.021526e+14 |  2008 |       2003 |    13 |           39 |           7 |              32 |            0 |            4 |               0 |                   0 |                    0 |                          0 |                36 |                0 |             4 |        5 |            0.8888889 |         0.0000000 |                    0 |          0.1111111 |                0.0000000 |                         0 |
| 27_1_71_20250     | 20250 |       71 |      27 | 4.490740e+14 |  2018 |       2013 |    15 |           27 |           0 |              27 |            5 |            4 |               0 |                   0 |                    0 |                         27 |                36 |                0 |             4 |        5 |            0.7500000 |         0.1388889 |                    0 |          0.1111111 |                0.0000000 |                         0 |
| 27_1_71_22001     | 22001 |       71 |      27 | 1.082972e+14 |  2009 |       2004 |    14 |           33 |           1 |              32 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                32 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_71_22001     | 22001 |       71 |      27 | 1.712548e+14 |  2014 |       2009 |    15 |           37 |           4 |              33 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                33 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_71_22001     | 22001 |       71 |      27 | 5.140785e+14 |  2019 |       2014 |    16 |           36 |           0 |              35 |            0 |            2 |               0 |                   0 |                    0 |                         36 |                37 |                0 |             2 |        5 |            0.9459459 |         0.0000000 |                    0 |          0.0540541 |                0.0000000 |                         0 |
| 27_1_71_23383     | 23383 |       71 |      27 | 2.213481e+14 |  2011 |       2006 |    14 |            5 |           3 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_71_23383     | 23383 |       71 |      27 | 3.001625e+14 |  2016 |       2011 |    15 |            6 |           1 |               5 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 5 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_71_23383     | 23383 |       71 |      27 | 7.218269e+14 |  2021 |       2016 |    16 |            9 |           3 |               6 |            0 |            0 |               0 |                   0 |                    0 |                          9 |                 6 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_75_20390     | 20390 |       75 |      27 | 1.083006e+14 |  2009 |       2004 |    14 |            2 |           1 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_75_20390     | 20390 |       75 |      27 | 1.712558e+14 |  2014 |       2009 |    15 |            2 |           0 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_75_24394     | 24394 |       75 |      27 | 1.025565e+14 |  2007 |       2002 |    13 |            6 |           3 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 5 |                2 |             2 |        5 |            0.6000000 |         0.0000000 |                    0 |          0.4000000 |                0.0000000 |                         0 |
| 27_1_75_24394     | 24394 |       75 |      27 | 2.423803e+14 |  2012 |       2007 |    14 |            9 |           3 |               6 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_1_75_24394     | 24394 |       75 |      27 | 3.727859e+14 |  2017 |       2012 |    15 |            9 |           2 |               7 |            2 |            0 |               0 |                   0 |                    0 |                          9 |                 9 |                0 |             0 |        5 |            0.7777778 |         0.2222222 |                    0 |          0.0000000 |                0.0000000 |                         0 |
| 27_2_135_20518    | 20518 |      135 |      27 | 1.024621e+14 |  2006 |       2001 |    13 |            0 |           0 |               0 |            0 |            9 |               0 |                   0 |                    0 |                          0 |                 9 |                0 |             9 |        5 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                0.0000000 |                         0 |

``` r
dbDisconnect(con, shutdown = TRUE)
```
