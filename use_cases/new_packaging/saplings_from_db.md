# Extract sapling transition tables

# Pulling trees

``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
source(here::here("R", "query_saplings.R"))

con <- connect_to_tables(here::here("data", "db", "foresttime-new.duckdb"))
```

``` r
saplings_mn <- query_saplings(con, 
                              conditions = create_conditions(
                                STATECD == 27
                              ))
```

    Joining with `by = join_by(PLOT_COMPOSITE_ID, INVYR)`

``` r
knitr::kable(head(saplings_mn, 40))
```

| PLOT_COMPOSITE_ID |  PLOT | COUNTYCD | STATECD |       PLT_CN | INVYR | PREV_INVYR | CYCLE | live_sapling | new_sapling | sapling_sapling | sapling_tree | sapling_dead | sapling_removed | sapling_not_sampled | sapling_missing_data | sapling_vanishes_next_year | PREV_live_sapling | sapling_vanished | presumed_dead | timespan | sapling_sapling_prop | sapling_tree_prop | sapling_removed_prop | presumed_dead_prop | sapling_not_sampled_prop | sapling_missing_data_prop |
|:------------------|------:|---------:|--------:|-------------:|------:|-----------:|------:|-------------:|------------:|----------------:|-------------:|-------------:|----------------:|--------------------:|---------------------:|---------------------------:|------------------:|-----------------:|--------------:|---------:|---------------------:|------------------:|---------------------:|-------------------:|-------------------------:|--------------------------:|
| 27_1_137_20242    | 20242 |      137 |      27 | 2.317369e+14 |  2015 |       2010 |    15 |            4 |           2 |               2 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             1 |        5 |            0.6666667 |         0.0000000 |                    0 |          0.3333333 |                        0 |                         0 |
| 27_1_137_20242    | 20242 |      137 |      27 | 6.105543e+14 |  2020 |       2015 |    16 |            4 |           1 |               3 |            0 |            1 |               0 |                   0 |                    0 |                          4 |                 4 |                0 |             1 |        5 |            0.7500000 |         0.0000000 |                    0 |          0.2500000 |                        0 |                         0 |
| 27_1_137_20458    | 20458 |      137 |      27 | 1.083012e+14 |  2009 |       2004 |    14 |            5 |           2 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_20458    | 20458 |      137 |      27 | 1.712559e+14 |  2014 |       2009 |    15 |            4 |           1 |               3 |            1 |            1 |               0 |                   0 |                    0 |                          0 |                 5 |                0 |             1 |        5 |            0.6000000 |         0.2000000 |                    0 |          0.2000000 |                        0 |                         0 |
| 27_1_137_20458    | 20458 |      137 |      27 | 5.140807e+14 |  2019 |       2014 |    16 |            0 |           0 |               0 |            0 |            4 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             4 |        5 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                        0 |                         0 |
| 27_1_137_25186    | 25186 |      137 |      27 | 1.025575e+14 |  2007 |       2002 |    13 |           10 |           8 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_25186    | 25186 |      137 |      27 | 2.423800e+14 |  2012 |       2007 |    14 |           13 |           3 |              10 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                10 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_25186    | 25186 |      137 |      27 | 3.727847e+14 |  2017 |       2012 |    15 |           11 |           0 |              11 |            1 |            1 |               0 |                   0 |                    0 |                         11 |                13 |                0 |             1 |        5 |            0.8461538 |         0.0769231 |                    0 |          0.0769231 |                        0 |                         0 |
| 27_1_137_25426    | 25426 |      137 |      27 | 2.423803e+14 |  2012 |       2007 |    14 |            9 |           1 |               8 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 8 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_25426    | 25426 |      137 |      27 | 3.727856e+14 |  2017 |       2012 |    15 |            9 |           0 |               9 |            0 |            0 |               0 |                   0 |                    0 |                          9 |                 9 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_25559    | 25559 |      137 |      27 | 1.025570e+14 |  2007 |       2002 |    13 |            1 |           0 |               1 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_25559    | 25559 |      137 |      27 | 2.423801e+14 |  2012 |       2007 |    14 |           11 |          11 |               0 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             1 |        5 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                        0 |                         0 |
| 27_1_137_25559    | 25559 |      137 |      27 | 3.727857e+14 |  2017 |       2012 |    15 |           23 |          14 |               9 |            0 |            2 |               0 |                   0 |                    0 |                         23 |                11 |                0 |             2 |        5 |            0.8181818 |         0.0000000 |                    0 |          0.1818182 |                        0 |                         0 |
| 27_1_137_26769    | 26769 |      137 |      27 | 1.082955e+14 |  2009 |       2004 |    14 |           17 |           3 |              14 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                14 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_26769    | 26769 |      137 |      27 | 1.712550e+14 |  2014 |       2009 |    15 |           16 |           2 |              14 |            3 |            0 |               0 |                   0 |                    0 |                          0 |                17 |                0 |             0 |        5 |            0.8235294 |         0.1764706 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_26769    | 26769 |      137 |      27 | 5.140779e+14 |  2019 |       2014 |    16 |           11 |           1 |              10 |            2 |            4 |               0 |                   0 |                    0 |                         11 |                16 |                0 |             4 |        5 |            0.6250000 |         0.1250000 |                    0 |          0.2500000 |                        0 |                         0 |
| 27_1_137_26849    | 26849 |      137 |      27 | 1.025565e+14 |  2007 |       2002 |    13 |            7 |           2 |               5 |            1 |            0 |               0 |                   0 |                    0 |                          0 |                 8 |                2 |             2 |        5 |            0.6250000 |         0.1250000 |                    0 |          0.2500000 |                        0 |                         0 |
| 27_1_137_26849    | 26849 |      137 |      27 | 3.727855e+14 |  2017 |       2012 |    15 |            4 |           0 |               4 |            1 |            0 |               0 |                   0 |                    0 |                          4 |                 5 |                0 |             0 |        5 |            0.8000000 |         0.2000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_26899    | 26899 |      137 |      27 | 1.021495e+14 |  2008 |       2003 |    13 |            6 |           3 |               3 |            0 |            2 |               0 |                   0 |                    0 |                          0 |                 5 |                0 |             2 |        5 |            0.6000000 |         0.0000000 |                    0 |          0.4000000 |                        0 |                         0 |
| 27_1_137_26899    | 26899 |      137 |      27 | 1.574074e+13 |  2013 |       2008 |    14 |            6 |           1 |               5 |            1 |            0 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             0 |        5 |            0.8333333 |         0.1666667 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_26899    | 26899 |      137 |      27 | 4.490731e+14 |  2018 |       2013 |    15 |            8 |           2 |               6 |            0 |            0 |               0 |                   0 |                    0 |                          8 |                 6 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_27579    | 27579 |      137 |      27 | 1.021580e+14 |  2008 |       2003 |    13 |            3 |           0 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 6 |                3 |             3 |        5 |            0.5000000 |         0.0000000 |                    0 |          0.5000000 |                        0 |                         0 |
| 27_1_137_27579    | 27579 |      137 |      27 | 1.574235e+13 |  2013 |       2008 |    14 |            5 |           2 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_137_30274    | 30274 |      137 |      27 | 1.082997e+14 |  2009 |       2004 |    14 |           28 |          11 |              17 |            0 |            5 |               0 |                   0 |                    0 |                          0 |                22 |                0 |             5 |        5 |            0.7727273 |         0.0000000 |                    0 |          0.2272727 |                        0 |                         0 |
| 27_1_137_30274    | 30274 |      137 |      27 | 1.712537e+14 |  2014 |       2009 |    15 |           32 |           8 |              24 |            0 |            4 |               0 |                   0 |                    0 |                          0 |                28 |                0 |             4 |        5 |            0.8571429 |         0.0000000 |                    0 |          0.1428571 |                        0 |                         0 |
| 27_1_137_30274    | 30274 |      137 |      27 | 5.140782e+14 |  2019 |       2014 |    16 |           29 |           2 |              27 |            1 |            4 |               0 |                   0 |                    0 |                         29 |                32 |                0 |             4 |        5 |            0.8437500 |         0.0312500 |                    0 |          0.1250000 |                        0 |                         0 |
| 27_1_17_20432     | 20432 |       17 |      27 | 1.025664e+14 |  2007 |       2002 |    13 |           15 |           5 |              10 |            0 |            3 |               0 |                   0 |                    0 |                          0 |                18 |                5 |             8 |        5 |            0.5555556 |         0.0000000 |                    0 |          0.4444444 |                        0 |                         0 |
| 27_1_17_20432     | 20432 |       17 |      27 | 2.423822e+14 |  2012 |       2007 |    14 |           19 |           4 |              15 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                15 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_31_20463     | 20463 |       31 |      27 | 1.021487e+14 |  2008 |       2003 |    13 |           27 |           1 |              26 |            2 |            3 |               0 |                   0 |                    0 |                          0 |                31 |                0 |             3 |        5 |            0.8387097 |         0.0645161 |                    0 |          0.0967742 |                        0 |                         0 |
| 27_1_31_20463     | 20463 |       31 |      27 | 1.574085e+13 |  2013 |       2008 |    14 |           27 |           1 |              26 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                27 |                0 |             1 |        5 |            0.9629630 |         0.0000000 |                    0 |          0.0370370 |                        0 |                         0 |
| 27_1_31_20463     | 20463 |       31 |      27 | 4.490732e+14 |  2018 |       2013 |    15 |           29 |           2 |              27 |            0 |            0 |               0 |                   0 |                    0 |                         29 |                27 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_71_22056     | 22056 |       71 |      27 | 9.892867e+13 |  2005 |       2000 |    13 |            6 |           1 |               5 |            1 |            1 |               0 |                   0 |                    0 |                          0 |                 7 |                0 |             1 |        5 |            0.7142857 |         0.1428571 |                    0 |          0.1428571 |                        0 |                         0 |
| 27_1_71_22056     | 22056 |       71 |      27 | 1.691066e+14 |  2010 |       2005 |    14 |            6 |           0 |               6 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_71_22056     | 22056 |       71 |      27 | 2.317363e+14 |  2015 |       2010 |    15 |            0 |           0 |               0 |            0 |            6 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             6 |        5 |            0.0000000 |         0.0000000 |                    0 |          1.0000000 |                        0 |                         0 |
| 27_1_71_22563     | 22563 |       71 |      27 | 1.024599e+14 |  2006 |       2001 |    13 |            2 |           0 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_71_22563     | 22563 |       71 |      27 | 2.213479e+14 |  2011 |       2006 |    14 |            0 |           0 |               0 |            0 |            0 |               0 |                   2 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            0.0000000 |         0.0000000 |                    0 |          0.0000000 |                        1 |                         0 |
| 27_1_71_22563     | 22563 |       71 |      27 | 3.001625e+14 |  2016 |       2011 |    15 |            3 |           3 |               0 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 0 |                0 |             0 |        5 |                   NA |                NA |                   NA |                 NA |                       NA |                        NA |
| 27_1_71_22563     | 22563 |       71 |      27 | 7.218268e+14 |  2021 |       2016 |    16 |            5 |           2 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          5 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_71_22703     | 22703 |       71 |      27 | 2.423795e+14 |  2012 |       2007 |    14 |            4 |           0 |               4 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |
| 27_1_71_22703     | 22703 |       71 |      27 | 3.727851e+14 |  2017 |       2012 |    15 |            5 |           1 |               4 |            0 |            0 |               0 |                   0 |                    0 |                          5 |                 4 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                    0 |          0.0000000 |                        0 |                         0 |

``` r
dbDisconnect(con, shutdown = TRUE)
```
