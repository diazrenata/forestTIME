# Extract sapling transition tables

# Pulling trees

``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
source(here::here("R", "query_saplings.R"))

con <- connect_to_tables(here::here("data", "db", "foresttime-tiny.duckdb"))
```

``` r
saplings_mn <- query_saplings(con, 
                              conditions = create_conditions(
                                STATECD == 27
                              ))
```

    Joining with `by = join_by(PLOT_COMPOSITE_ID, INVYR)`

``` r
knitr::kable(head(saplings_mn, 40))
```

| PLOT_COMPOSITE_ID |  PLOT | COUNTYCD | STATECD |       PLT_CN | INVYR | PREV_INVYR | CYCLE | live_sapling | new_sapling | sapling_sapling | sapling_tree | sapling_dead | sapling_removed | sapling_not_sampled | sapling_missing_data | sapling_vanishes_next_year | PREV_live_sapling | sapling_vanished | presumed_dead | timespan | sapling_sapling_prop | sapling_tree_prop | sapling_removed_prop | presumed_dead_prop | sapling_not_sampled_prop | sapling_missing_data_prop |
|:------------------|------:|---------:|--------:|-------------:|------:|-----------:|------:|-------------:|------------:|----------------:|-------------:|-------------:|----------------:|--------------------:|---------------------:|---------------------------:|------------------:|-----------------:|--------------:|---------:|---------------------:|------------------:|---------------------:|-------------------:|-------------------------:|--------------------------:|
| 27_1_71_22220     | 22220 |       71 |      27 | 3.001609e+14 |  2016 |       2011 |    15 |           10 |           0 |              10 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                11 |                0 |             1 |        5 |            0.9090909 |         0.0000000 |                  0.0 |          0.0909091 |                     0.00 |                         0 |
| 27_1_71_23342     | 23342 |       71 |      27 | 3.001609e+14 |  2016 |       2011 |    15 |           37 |          37 |               0 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 0 |                0 |             0 |        5 |                   NA |                NA |                   NA |                 NA |                       NA |                        NA |
| 27_1_71_23203     | 23203 |       71 |      27 | 3.001609e+14 |  2016 |       2011 |    15 |           15 |           4 |              11 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                11 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_1_71_22573     | 22573 |       71 |      27 | 3.001609e+14 |  2016 |       2011 |    15 |            8 |           8 |               0 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 0 |                0 |             0 |        5 |                   NA |                NA |                   NA |                 NA |                       NA |                        NA |
| 27_4_91_20011     | 20011 |       91 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            4 |           2 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_3_95_20051     | 20051 |       95 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            2 |           0 |               2 |            0 |            2 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             2 |        5 |            0.5000000 |         0.0000000 |                  0.0 |          0.5000000 |                     0.00 |                         0 |
| 27_3_95_20030     | 20030 |       95 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |           25 |           3 |              22 |            0 |           10 |               0 |                   0 |                    0 |                          0 |                32 |                0 |            10 |        5 |            0.6875000 |         0.0000000 |                  0.0 |          0.3125000 |                     0.00 |                         0 |
| 27_3_9_20136      | 20136 |        9 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            4 |           2 |               2 |            0 |            3 |               0 |                   0 |                    0 |                          0 |                 5 |                0 |             3 |        5 |            0.4000000 |         0.0000000 |                  0.0 |          0.6000000 |                     0.00 |                         0 |
| 27_3_141_20106    | 20106 |      141 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            1 |           0 |               1 |            0 |            0 |               0 |                   3 |                    0 |                          0 |                 4 |                0 |             0 |        5 |            0.2500000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.75 |                         0 |
| 27_3_115_20732    | 20732 |      115 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            2 |           0 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_3_115_20506    | 20506 |      115 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            4 |           1 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_3_115_20112    | 20112 |      115 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            9 |           3 |               6 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 7 |                0 |             1 |        5 |            0.8571429 |         0.0000000 |                  0.0 |          0.1428571 |                     0.00 |                         0 |
| 27_3_115_20114    | 20114 |      115 |      27 | 3.001610e+14 |  2016 |       2011 |    15 |            4 |           0 |               4 |            0 |            4 |               0 |                   0 |                    0 |                          0 |                 8 |                0 |             4 |        5 |            0.5000000 |         0.0000000 |                  0.0 |          0.5000000 |                     0.00 |                         0 |
| 27_3_25_20010     | 20010 |       25 |      27 | 3.727857e+14 |  2017 |       2012 |    15 |            0 |           0 |               0 |            1 |            2 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             2 |        5 |            0.0000000 |         0.3333333 |                  0.0 |          0.6666667 |                     0.00 |                         0 |
| 27_2_135_20133    | 20133 |      135 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            7 |           0 |               7 |            0 |            7 |               0 |                   0 |                    0 |                          0 |                14 |                0 |             7 |        5 |            0.5000000 |         0.0000000 |                  0.0 |          0.5000000 |                     0.00 |                         0 |
| 27_2_135_20059    | 20059 |      135 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            3 |           0 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_4_89_20149     | 20149 |       89 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |           40 |           7 |              33 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                34 |                0 |             1 |        5 |            0.9705882 |         0.0000000 |                  0.0 |          0.0294118 |                     0.00 |                         0 |
| 27_2_135_20444    | 20444 |      135 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            0 |           0 |               0 |            0 |            0 |               0 |                  24 |                    0 |                          0 |                24 |                0 |             0 |        5 |            0.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     1.00 |                         0 |
| 27_4_69_20336     | 20336 |       69 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            3 |           1 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_4_69_20373     | 20373 |       69 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            6 |           3 |               3 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             1 |        5 |            0.7500000 |         0.0000000 |                  0.0 |          0.2500000 |                     0.00 |                         0 |
| 27_4_27_20346     | 20346 |       27 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            0 |           0 |               0 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 1 |                0 |             1 |        5 |            0.0000000 |         0.0000000 |                  0.0 |          1.0000000 |                     0.00 |                         0 |
| 27_2_135_20109    | 20109 |      135 |      27 | 3.001601e+14 |  2016 |       2011 |    15 |            0 |           0 |               0 |            1 |            1 |               0 |                   0 |                    0 |                          0 |                 2 |                0 |             1 |        5 |            0.0000000 |         0.5000000 |                  0.0 |          0.5000000 |                     0.00 |                         0 |
| 27_2_7_20946      | 20946 |        7 |      27 | 3.001602e+14 |  2016 |       2011 |    15 |            7 |           1 |               6 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 7 |                0 |             1 |        5 |            0.8571429 |         0.0000000 |                  0.0 |          0.1428571 |                     0.00 |                         0 |
| 27_2_7_20914      | 20914 |        7 |      27 | 3.001602e+14 |  2016 |       2011 |    15 |            5 |           1 |               4 |            1 |            2 |               0 |                   0 |                    0 |                          0 |                 7 |                0 |             2 |        5 |            0.5714286 |         0.1428571 |                  0.0 |          0.2857143 |                     0.00 |                         0 |
| 27_2_29_20216     | 20216 |       29 |      27 | 3.001602e+14 |  2016 |       2011 |    15 |            9 |           2 |               7 |            1 |            1 |               0 |                   0 |                    0 |                          0 |                 9 |                0 |             1 |        5 |            0.7777778 |         0.1111111 |                  0.0 |          0.1111111 |                     0.00 |                         0 |
| 27_4_165_20214    | 20214 |      165 |      27 | 3.727848e+14 |  2017 |       2012 |    15 |            5 |           1 |               4 |            0 |            2 |               0 |                   0 |                    0 |                          5 |                 6 |                0 |             2 |        5 |            0.6666667 |         0.0000000 |                  0.0 |          0.3333333 |                     0.00 |                         0 |
| 27_2_35_20112     | 20112 |       35 |      27 | 3.727848e+14 |  2017 |       2012 |    15 |            8 |           1 |               7 |            0 |            3 |               0 |                   0 |                    0 |                          8 |                10 |                0 |             3 |        5 |            0.7000000 |         0.0000000 |                  0.0 |          0.3000000 |                     0.00 |                         0 |
| 27_2_61_29038     | 29038 |       61 |      27 | 3.727848e+14 |  2017 |       2012 |    15 |           16 |          10 |               6 |            1 |            0 |               0 |                   0 |                    0 |                         16 |                 7 |                0 |             0 |        5 |            0.8571429 |         0.1428571 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_2_61_20087     | 20087 |       61 |      27 | 3.727849e+14 |  2017 |       2012 |    15 |            4 |           0 |               4 |            2 |            0 |               0 |                   0 |                    0 |                          4 |                 6 |                0 |             0 |        5 |            0.6666667 |         0.3333333 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_2_61_20188     | 20188 |       61 |      27 | 3.727849e+14 |  2017 |       2012 |    15 |           10 |           5 |               5 |            0 |           22 |               0 |                   0 |                    0 |                         10 |                27 |                0 |            22 |        5 |            0.1851852 |         0.0000000 |                  0.0 |          0.8148148 |                     0.00 |                         0 |
| 27_2_61_21285     | 21285 |       61 |      27 | 3.727849e+14 |  2017 |       2012 |    15 |            1 |           0 |               1 |            1 |            0 |               0 |                   0 |                    0 |                          1 |                 2 |                0 |             0 |        5 |            0.5000000 |         0.5000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_2_61_20062     | 20062 |       61 |      27 | 3.727849e+14 |  2017 |       2012 |    15 |            2 |           0 |               2 |            0 |            0 |               0 |                   0 |                    0 |                          2 |                 2 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_2_1_20400      | 20400 |        1 |      27 | 3.727849e+14 |  2017 |       2012 |    15 |            4 |           0 |               4 |            1 |            1 |               0 |                   0 |                    0 |                          4 |                 6 |                0 |             1 |        5 |            0.6666667 |         0.1666667 |                  0.0 |          0.1666667 |                     0.00 |                         0 |
| 27_1_137_26233    | 26233 |      137 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |           11 |           5 |               6 |            1 |            1 |               0 |                   0 |                    0 |                          0 |                 8 |                0 |             1 |        5 |            0.7500000 |         0.1250000 |                  0.0 |          0.1250000 |                     0.00 |                         0 |
| 27_2_61_20364     | 20364 |       61 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |            4 |           1 |               3 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 4 |                0 |             1 |        5 |            0.7500000 |         0.0000000 |                  0.0 |          0.2500000 |                     0.00 |                         0 |
| 27_2_61_20834     | 20834 |       61 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |            6 |           0 |               6 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 6 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |
| 27_2_61_29005     | 29005 |       61 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |            4 |           0 |               4 |            0 |            1 |               0 |                   0 |                    0 |                          0 |                 5 |                0 |             1 |        5 |            0.8000000 |         0.0000000 |                  0.0 |          0.2000000 |                     0.00 |                         0 |
| 27_1_137_26261    | 26261 |      137 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |           10 |           6 |               4 |            0 |            0 |               4 |                   0 |                    0 |                          0 |                 8 |                0 |             0 |        5 |            0.5000000 |         0.0000000 |                  0.5 |          0.0000000 |                     0.00 |                         0 |
| 27_2_61_20376     | 20376 |       61 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |            3 |           1 |               2 |            0 |            7 |               0 |                   0 |                    0 |                          0 |                 9 |                0 |             7 |        5 |            0.2222222 |         0.0000000 |                  0.0 |          0.7777778 |                     0.00 |                         0 |
| 27_2_61_20378     | 20378 |       61 |      27 | 3.001603e+14 |  2016 |       2011 |    15 |            4 |           1 |               3 |            0 |            0 |               0 |                   0 |                    0 |                          0 |                 3 |                0 |             0 |        5 |            1.0000000 |         0.0000000 |                  0.0 |          0.0000000 |                     0.00 |                         0 |

``` r
dbDisconnect(con, shutdown = TRUE)
```
