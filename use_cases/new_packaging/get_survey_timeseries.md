# Pulling timeseries of surveys

``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
con <- connect_to_tables(here::here("data", "db", "foresttime-to-share.duckdb"))
```

``` r
qa_d_wb_pine <- query_tree_surveys(
  con = con,
  conditions = create_conditions(
    STATECD == 30,
    SPCD == 101,
    ANY_SPCD_FLAG == FALSE
  ),
  variables = c(
    "STATUSCD",
    "STATUSCD_CORR",
    "STATUSCD_FLAG",
    "DIA",
    "HT",
    "COND_STATUS_CD",
    "LAT",
    "LON",
    "BALIVE",
    "SICOND",
    "SISP",
    "SIBASE",
    "DSTRBCD1",
    "DSTRBYR1",
    "DSTRBCD2",
    "DSTRBYR2",
    "DSTRBCD3",
    "DSTRBYR3",
    "SDIMAX_RMRS",
    "SDI_RMRS",
    "SLOPE",
    "ASPECT",
    "CONDPROP_UNADJ",
    "RECONCILECD"
  )
)
```

    Joining with `by = join_by(TREE_COMPOSITE_ID, PLOT_COMPOSITE_ID, PLOT, SUBP, STATECD, COUNTYCD)`
    Joining with `by = join_by(TREE_COMPOSITE_ID, SPCD_CORR, TREE_CN, INVYR, STATUSCD, SPCD, CYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CYCLE, SUBCYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CONDID, CYCLE, SUBCYCLE)`

``` r
knitr::kable(head(qa_d_wb_pine, 20))
```

| TREE_COMPOSITE_ID  | PLOT_COMPOSITE_ID | SPCD |  PLOT | SUBP | COUNTYCD | STATECD |       PLT_CN | INVYR | CYCLE | MEASYEAR |      TREE_CN |      COND_CN | CONDID | STATUSCD | STATUSCD_CORR | STATUSCD_FLAG |  DIA |  HT | COND_STATUS_CD |      LAT |       LON |   BALIVE | SICOND | SISP | SIBASE | DSTRBCD1 | DSTRBYR1 | DSTRBCD2 | DSTRBYR2 | DSTRBCD3 | DSTRBYR3 | SDIMAX_RMRS | SDI_RMRS | SLOPE | ASPECT | CONDPROP_UNADJ | RECONCILECD |
|:-------------------|:------------------|-----:|------:|-----:|---------:|--------:|-------------:|------:|------:|---------:|-------------:|-------------:|-------:|---------:|--------------:|:--------------|-----:|----:|---------------:|---------:|----------:|---------:|-------:|-----:|-------:|---------:|---------:|---------:|---------:|---------:|:---------|:------------|:---------|------:|-------:|---------------:|:------------|
| 30_5_23_85758_2_11 | 30_5_23_85758     |  101 | 85758 |    2 |       23 |      30 | 3.143271e+13 |  2008 |     2 |     2008 | 3.143275e+13 | 3.143271e+13 |      2 |        1 |             1 | FALSE         | 11.7 |  53 |              1 | 45.98392 | -113.2554 | 127.8860 |     22 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 254.4154 |    30 |     68 |       0.500000 | NA          |
| 30_5_23_86138_4_2  | 30_5_23_86138     |  101 | 86138 |    4 |       23 |      30 | 3.143283e+13 |  2008 |     2 |     2008 | 3.143289e+13 | 3.143283e+13 |      1 |        1 |             1 | FALSE         |  6.0 |  26 |              1 | 46.12096 | -113.1336 | 122.4805 |     22 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 735         | 361.4942 |    25 |      4 |       1.000000 | NA          |
| 30_4_77_90060_4_6  | 30_4_77_90060     |  101 | 90060 |    4 |       77 |      30 | 1.236256e+13 |  2007 |     2 |     2007 | 1.236259e+13 | 1.236257e+13 |      2 |        2 |             2 | FALSE         |  7.7 |  46 |              1 | 47.07516 | -112.8446 |  63.1035 |     18 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 128.075  |    65 |    308 |       0.500000 | NA          |
| 30_1_29_94260_1_1  | 30_1_29_94260     |  101 | 94260 |    1 |       29 |      30 | 1.185711e+13 |  2006 |     2 |     2006 | 1.185713e+13 | 1.185712e+13 |      1 |        1 |             1 | FALSE         |  5.2 |  21 |              1 | 48.73057 | -114.4147 |  46.5561 |     17 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 735         | 125.1322 |    26 |     68 |       1.000000 | NA          |
| 30_5_1_85393_3_1   | 30_5_1_85393      |  101 | 85393 |    3 |        1 |      30 | 1.184704e+13 |  2006 |     2 |     2006 | 1.184709e+13 | 1.184704e+13 |      1 |        1 |             1 | FALSE         |  5.9 |  29 |              1 | 45.62468 | -113.1793 | 218.3575 |     34 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 700         | 427.1168 |    32 |    186 |       1.000000 | NA          |
| 30_5_1_86266_1_14  | 30_5_1_86266      |  101 | 86266 |    1 |        1 |      30 | 1.184718e+13 |  2006 |     2 |     2006 | 1.184721e+13 | 1.184718e+13 |      1 |        1 |             1 | FALSE         |  9.1 |  52 |              1 | 45.34742 | -113.6794 | 232.7199 |     48 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 411.122  |    50 |    337 |       1.000000 | NA          |
| 30_5_1_88676_3_2   | 30_5_1_88676      |  101 | 88676 |    3 |        1 |      30 | 1.184756e+13 |  2006 |     2 |     2006 | 1.184757e+13 | 1.184756e+13 |      2 |        1 |             1 | FALSE         |  8.3 |  25 |              1 | 44.81987 | -113.1508 |  51.2672 |     21 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 470         | 104.0861 |    17 |    243 |       0.250000 | NA          |
| 30_5_1_92895_4_7   | 30_5_1_92895      |  101 | 92895 |    4 |        1 |      30 | 1.184791e+13 |  2006 |     2 |     2006 | 1.184797e+13 | 1.184791e+13 |      1 |        1 |             1 | FALSE         |  5.0 |  24 |              1 | 45.44019 | -113.1820 | 109.8860 |     25 |  108 |     50 |       22 |     9999 |        0 |       NA |       NA | NA       | 700         | 235.1978 |     3 |      0 |       1.000000 | NA          |
| 30_5_1_88373_2_14  | 30_5_1_88373      |  101 | 88373 |    2 |        1 |      30 | 1.184751e+13 |  2006 |     2 |     2006 | 1.184754e+13 | 1.184751e+13 |      1 |        1 |             1 | FALSE         |  2.7 |  17 |              1 | 45.49432 | -112.9824 | 148.7677 |     38 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 263.4976 |    53 |    253 |       1.000000 | NA          |
| 30_2_99_94552_1_19 | 30_2_99_94552     |  101 | 94552 |    1 |       99 |      30 | 1.188201e+13 |  2006 |     2 |     2006 | 1.188204e+13 | 1.188202e+13 |      1 |        1 |             1 | FALSE         | 11.7 |  75 |              1 | 47.92516 | -112.8758 | 235.9906 |     29 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 386.8185 |     3 |      0 |       1.000000 | NA          |
| 30_5_67_94868_2_1  | 30_5_67_94868     |  101 | 94868 |    2 |       67 |      30 | 1.187279e+13 |  2006 |     2 |     2007 | 1.187282e+13 | 1.187279e+13 |      1 |        2 |             2 | FALSE         |  7.9 |  37 |              1 | 45.46932 | -110.8109 |   0.0000 |     32 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 700         | 0.0      |    32 |     78 |       1.000000 | NA          |
| 30_3_39_88061_3_7  | 30_3_39_88061     |  101 | 88061 |    3 |       39 |      30 | 1.186048e+13 |  2006 |     2 |     2006 | 1.186053e+13 | 1.186048e+13 |      1 |        1 |             1 | FALSE         |  1.1 |  10 |              1 | 46.15913 | -113.7245 | 106.7035 |     32 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 700         | 234.1242 |    11 |    228 |       1.000000 | NA          |
| 30_3_39_90325_2_11 | 30_3_39_90325     |  101 | 90325 |    2 |       39 |      30 | 1.186075e+13 |  2006 |     2 |     2006 | 1.186078e+13 | 1.186075e+13 |      2 |        1 |             1 | FALSE         | 17.2 |  65 |              1 | 46.27594 | -113.1872 | 340.0908 |     38 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 470         | 596.7261 |     5 |    282 |       0.094817 | NA          |
| 30_4_49_81900_2_1  | 30_4_49_81900     |  101 | 81900 |    2 |       49 |      30 | 1.186365e+13 |  2006 |     2 |     2006 | 1.186367e+13 | 1.186365e+13 |      1 |        2 |             2 | FALSE         | 10.0 |  45 |              1 | 47.25633 | -112.8493 |  63.8763 |     33 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 700         | 110.9531 |    42 |    142 |       1.000000 | NA          |
| 30_1_53_91604_1_6  | 30_1_53_91604     |  101 | 91604 |    1 |       53 |      30 | 1.186667e+13 |  2006 |     2 |     2006 | 1.186669e+13 | 1.186667e+13 |      1 |        2 |             2 | FALSE         | 10.2 |  50 |              1 | 48.70694 | -115.9819 | 108.9177 |     33 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 735         | 208.1973 |    32 |    167 |       1.000000 | NA          |
| 30_4_77_90492_3_1  | 30_4_77_90492     |  101 | 90492 |    3 |       77 |      30 | 1.236262e+13 |  2007 |     2 |     2008 | 3.142356e+13 | 1.236262e+13 |      1 |        2 |             2 | FALSE         | 17.6 |  53 |              1 | 47.16564 | -112.9812 |   4.4831 |     25 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 9.3493   |    38 |     41 |       0.750000 | NA          |
| 30_4_77_94294_3_1  | 30_4_77_94294     |  101 | 94294 |    3 |       77 |      30 | 1.236268e+13 |  2007 |     2 |     2007 | 1.236270e+13 | 1.236268e+13 |      1 |        1 |             1 | FALSE         |  5.7 |  31 |              1 | 47.56926 | -113.1995 | 128.7345 |     39 |  202 |     50 |       12 |     9999 |        0 |       NA |       NA | NA       | 595         | 185.0417 |    73 |    278 |       1.000000 | NA          |
| 30_4_77_94882_3_1  | 30_4_77_94882     |  101 | 94882 |    3 |       77 |      30 | 1.236272e+13 |  2007 |     2 |     2007 | 1.236274e+13 | 1.236272e+13 |      1 |        2 |             2 | FALSE         | 10.3 |  50 |              1 | 47.20686 | -113.1810 |  71.4660 |     26 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 670         | 134.1613 |    45 |     10 |       1.000000 | NA          |
| 30_5_57_86309_4_9  | 30_5_57_86309     |  101 | 86309 |    4 |       57 |      30 | 1.186804e+13 |  2006 |     2 |     2006 | 1.186809e+13 | 1.186804e+13 |      1 |        1 |             1 | FALSE         |  5.1 |  13 |              1 | 44.97272 | -111.8252 | 147.4150 |     20 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 470         | 280.6887 |    55 |    239 |       1.000000 | NA          |
| 30_3_63_86047_4_6  | 30_3_63_86047     |  101 | 86047 |    4 |       63 |      30 | 1.187092e+13 |  2006 |     2 |     2006 | 1.187094e+13 | 1.187092e+13 |      1 |        2 |             2 | FALSE         | 13.3 |  35 |              1 | 47.59587 | -113.9260 |  62.5255 |     20 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 735         | 113.5468 |    58 |    147 |       1.000000 | NA          |

``` r
dbDisconnect(con, shutdown = TRUE)
```
