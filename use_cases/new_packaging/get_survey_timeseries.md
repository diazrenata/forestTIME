# Pulling timeseries of surveys


``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
con <- connect_to_tables(here::here("data", "db", "foresttime-from-state-parquet.duckdb"))
```

``` r
qa_d_wb_pine <- query_tree_surveys(
  con = con,
  conditions = create_conditions(
    STATECD == 30,
    SPCD == 101,
    ANY_SPCD_FLAG == FALSE
  ),
  variables = c(
    "STATUSCD",
    "STATUSCD_CORR",
    "STATUSCD_FLAG",
    "DIA",
    "HT",
    "COND_STATUS_CD",
    "LAT",
    "LON",
    "BALIVE",
    "SICOND",
    "SISP",
    "SIBASE",
    "DSTRBCD1",
    "DSTRBYR1",
    "DSTRBCD2",
    "DSTRBYR2",
    "DSTRBCD3",
    "DSTRBYR3",
    "SDIMAX_RMRS",
    "SDI_RMRS",
    "SLOPE",
    "ASPECT",
    "CONDPROP_UNADJ",
    "RECONCILECD"
  )
)
```

    Joining with `by = join_by(TREE_COMPOSITE_ID, PLOT_COMPOSITE_ID, PLOT, SUBP, STATECD, COUNTYCD)`
    Joining with `by = join_by(TREE_COMPOSITE_ID, SPCD_CORR, TREE_CN, INVYR, STATUSCD, SPCD, CYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CYCLE, SUBCYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CONDID, CYCLE, SUBCYCLE)`

``` r
knitr::kable(head(qa_d_wb_pine, 20))
```

| TREE_COMPOSITE_ID  | PLOT_COMPOSITE_ID | SPCD |  PLOT | SUBP | COUNTYCD | STATECD |       PLT_CN | INVYR | CYCLE | MEASYEAR |      TREE_CN |      COND_CN | CONDID | STATUSCD | STATUSCD_CORR | STATUSCD_FLAG |  DIA |  HT | COND_STATUS_CD |      LAT |       LON |   BALIVE | SICOND | SISP | SIBASE | DSTRBCD1 | DSTRBYR1 | DSTRBCD2 | DSTRBYR2 | DSTRBCD3 | DSTRBYR3 | SDIMAX_RMRS | SDI_RMRS | SLOPE | ASPECT | CONDPROP_UNADJ | RECONCILECD |
|:-------------------|:------------------|-----:|------:|-----:|---------:|--------:|-------------:|------:|------:|---------:|-------------:|-------------:|-------:|---------:|--------------:|:--------------|-----:|----:|---------------:|---------:|----------:|---------:|-------:|-----:|-------:|---------:|---------:|---------:|---------:|---------:|:---------|:------------|:---------|------:|-------:|---------------:|:------------|
| 30_5_67_92140_1_29 | 30_5_67_92140     |  101 | 92140 |    1 |       67 |      30 | 1.887679e+14 |  2017 |     3 |     2017 | 5.113700e+14 | 5.113700e+14 |      1 |        2 |             2 | FALSE         |  4.0 |  15 |              1 | 45.20046 | -110.6239 |  44.2245 |     36 |   93 |     50 |       22 |     2010 |        0 |       NA |        0 | NA       | 670         | 88.6304  |     4 |      0 |       1.000000 | 4           |
| 30_5_67_88419_3_23 | 30_5_67_88419     |  101 | 88419 |    3 |       67 |      30 | 1.887695e+14 |  2018 |     3 |     2018 | 6.847428e+14 | 6.847427e+14 |      1 |        1 |             1 | FALSE         |  1.4 |  12 |              1 | 45.01867 | -110.9395 | 123.2359 |     38 |  108 |     50 |       10 |     9999 |       60 |     9999 |        0 | NA       | 700         | 241.2845 |    18 |    132 |       1.000000 | NA          |
| 30_5_67_89355_4_7  | 30_5_67_89355     |  101 | 89355 |    4 |       67 |      30 | 1.887695e+14 |  2018 |     3 |     2018 | 6.847434e+14 | 6.847434e+14 |      1 |        2 |             2 | FALSE         | 17.2 |  49 |              1 | 45.14997 | -110.2372 |  65.8098 |     26 |   93 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 735         | 144.8983 |    60 |    120 |       1.000000 | NA          |
| 30_5_57_87376_4_12 | 30_5_57_87376     |  101 | 87376 |    4 |       57 |      30 | 3.560028e+14 |  2019 |     3 |     2019 | 7.502193e+14 | 7.502192e+14 |      1 |        2 |             2 | FALSE         |  5.8 |  38 |              1 | 44.77127 | -111.7163 | 122.8838 |     34 |  202 |     50 |       12 |     9999 |        0 |       NA |        0 | NA       | 595         | 237.7835 |    45 |     20 |       1.000000 | 4           |
| 30_3_81_90243_4_4  | 30_3_81_90243     |  101 | 90243 |    4 |       81 |      30 | 1.887641e+14 |  2015 |     3 |     2015 | 3.737837e+14 | 3.737836e+14 |      1 |        2 |             2 | FALSE         | 11.0 |  52 |              1 | 45.70590 | -114.0407 |  73.9845 |     40 |   93 |     50 |       12 |     9999 |        0 |       NA |        0 | NA       | 735         | 168.6672 |    25 |    321 |       1.000000 | NA          |
| 30_4_49_91127_3_5  | 30_4_49_91127     |  101 | 91127 |    3 |       49 |      30 | 1.887641e+14 |  2015 |     3 |     2015 | 3.737839e+14 | 3.737839e+14 |      1 |        2 |             2 | FALSE         |  5.0 |  23 |              1 | 47.03399 | -112.7130 |  52.4337 |     20 |   93 |     50 |       12 |     9999 |        0 |       NA |        0 | NA       | 735         | 100.2107 |    40 |    153 |       1.000000 | NA          |
| 30_3_63_84074_1_2  | 30_3_63_84074     |  101 | 84074 |    1 |       63 |      30 | 1.887644e+14 |  2015 |     3 |     2015 | 3.738039e+14 | 3.738038e+14 |      1 |        2 |             2 | FALSE         |  5.8 |  25 |              1 | 47.05188 | -113.9630 |  32.3475 |     31 |   93 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 735         | 64.0798  |    67 |    162 |       0.750000 | NA          |
| 30_4_43_81886_4_2  | 30_4_43_81886     |  101 | 81886 |    4 |       43 |      30 | 1.887644e+14 |  2015 |     3 |     2015 | 3.738039e+14 | 3.738039e+14 |      1 |        2 |             2 | FALSE         | 12.1 |  33 |              1 | 46.41178 | -111.8471 |   0.0000 |     NA |   NA |     NA |       50 |     2014 |        0 |       NA |        0 | NA       | 470         | 0.0      |    63 |    312 |       1.000000 | NA          |
| 30_5_67_93046_4_1  | 30_5_67_93046     |  101 | 93046 |    4 |       67 |      30 | 1.887663e+14 |  2016 |     3 |     2016 | 4.741880e+14 | 4.741880e+14 |      2 |        2 |             2 | FALSE         |  5.1 |  24 |              1 | 45.15977 | -110.6193 |  44.4311 |     26 |  108 |     50 |       10 |     2008 |        0 |       NA |        0 | NA       | 470         | 81.9451  |    45 |    200 |       0.250000 | NA          |
| 30_1_29_91838_4_5  | 30_1_29_91838     |  101 | 91838 |    4 |       29 |      30 | 1.887656e+14 |  2016 |     3 |     2016 | 4.741573e+14 | 4.741573e+14 |      1 |        2 |             2 | FALSE         |   NA |  NA |              1 | 48.27460 | -113.7678 |   5.7956 |     20 |   93 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 735         | 16.5503  |    70 |    126 |       1.000000 | NA          |
| 30_5_23_87908_3_11 | 30_5_23_87908     |  101 | 87908 |    3 |       23 |      30 | 1.887660e+14 |  2016 |     3 |     2016 | 4.741757e+14 | 4.741756e+14 |      1 |        1 |             1 | FALSE         |  3.1 |  13 |              1 | 45.98036 | -113.3146 |  93.0696 |     26 |  108 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 470         | 233.061  |    30 |    196 |       1.000000 | NA          |
| 30_1_29_82541_3_1  | 30_1_29_82541     |  101 | 82541 |    3 |       29 |      30 | 1.887660e+14 |  2016 |     3 |     2016 | 4.741774e+14 | 4.741773e+14 |      1 |        1 |             1 | FALSE         | 20.1 |  81 |              1 | 48.75771 | -114.5120 | 118.4171 |     34 |   93 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 670         | 203.9137 |    12 |     64 |       1.000000 | NA          |
| 30_1_29_94260_3_6  | 30_1_29_94260     |  101 | 94260 |    3 |       29 |      30 | 1.887660e+14 |  2016 |     3 |     2016 | 4.741775e+14 | 4.741774e+14 |      1 |        2 |             2 | FALSE         |  4.9 |  24 |              1 | 48.73057 | -114.4147 |  67.9777 |     22 |   93 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 735         | 175.4404 |    26 |     68 |       1.000000 | 4           |
| 30_1_29_84898_3_2  | 30_1_29_84898     |  101 | 84898 |    3 |       29 |      30 | 1.887675e+14 |  2017 |     3 |     2018 | 6.821668e+14 | 6.821667e+14 |      1 |        1 |             1 | FALSE         |  8.9 |  36 |              1 | 47.69313 | -113.5383 |  73.1660 |     24 |   93 |     50 |       12 |     9999 |        0 |       NA |        0 | NA       | 735         | 168.5721 |    75 |    286 |       0.750000 | NA          |
| 30_1_29_92000_4_6  | 30_1_29_92000     |  101 | 92000 |    4 |       29 |      30 | 1.887676e+14 |  2017 |     3 |     2018 | 6.821670e+14 | 6.821669e+14 |      1 |        1 |             1 | FALSE         |  9.6 |  52 |              1 | 48.82237 | -114.4828 | 165.4941 |     24 |   93 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 670         | 359.2849 |    55 |    317 |       1.000000 | NA          |
| 30_5_23_94391_4_1  | 30_5_23_94391     |  101 | 94391 |    4 |       23 |      30 | 1.887676e+14 |  2017 |     3 |     2018 | 6.821670e+14 | 6.821670e+14 |      3 |        1 |             1 | FALSE         |  1.5 |   9 |              1 | 46.03799 | -113.0021 |   3.6797 |     24 |  108 |     50 |        0 |       NA |        0 |       NA |        0 | NA       | 470         | 14.4101  |    25 |      4 |       0.235297 | 1           |
| 30_5_31_86358_4_3  | 30_5_31_86358     |  101 | 86358 |    4 |       31 |      30 | 1.887678e+14 |  2017 |     3 |     2018 | 6.821680e+14 | 6.821680e+14 |      1 |        2 |             2 | FALSE         |   NA |  NA |              1 | 45.38079 | -110.9342 |  10.9715 |     22 |  108 |     50 |       22 |     9999 |        0 |       NA |        0 | NA       | 470         | 28.2838  |    50 |    128 |       0.750000 | NA          |
| 30_3_63_93118_3_3  | 30_3_63_93118     |  101 | 93118 |    3 |       63 |      30 | 1.235815e+13 |  2007 |     2 |     2007 | 1.235817e+13 | 1.235815e+13 |      1 |        2 |             2 | FALSE         |  9.5 |  22 |              1 | 47.37100 | -113.8548 |  10.6917 |     26 |   93 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 735         | 30.9422  |    30 |    125 |       1.000000 | NA          |
| 30_5_67_85692_1_7  | 30_5_67_85692     |  101 | 85692 |    1 |       67 |      30 | 1.235917e+13 |  2007 |     2 |     2007 | 1.235918e+13 | 1.235917e+13 |      1 |        1 |             1 | FALSE         |  8.5 |  45 |              1 | 45.37945 | -110.2350 | 145.8579 |     25 |  108 |     50 |        0 |       NA |       NA |       NA |       NA | NA       | 470         | 286.0231 |    45 |     50 |       1.000000 | NA          |
| 30_5_67_87815_3_1  | 30_5_67_87815     |  101 | 87815 |    3 |       67 |      30 | 1.235946e+13 |  2007 |     2 |     2007 | 1.235949e+13 | 1.235946e+13 |      1 |        2 |             2 | FALSE         |  6.7 |  32 |              1 | 45.42280 | -110.4275 |   0.0000 |     27 |   93 |     50 |       30 |     2006 |        0 |       NA |       NA | NA       | 735         | 0.0      |    75 |    105 |       1.000000 | NA          |

``` r
dbDisconnect(con, shutdown = TRUE)
```
