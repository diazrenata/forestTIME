# Pulling timeseries of surveys

``` r
source(here::here("R", "query_tables_db_fxns.R"))
```

    Loading required package: DBI

    Warning: package 'DBI' was built under R version 4.3.2

    Warning: package 'dplyr' was built under R version 4.3.2


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
con <- connect_to_tables(here::here("data", "db", "foresttime-tiny.duckdb"))
```

``` r
qa_d_wb_pine <- query_tree_surveys(
  con = con,
  conditions = create_conditions(
    STATECD == 30,
    SPCD == 101,
    ANY_SPCD_FLAG == FALSE
  ),
  variables = c(
    "STATUSCD",
    "STATUSCD_CORR",
    "STATUSCD_FLAG",
    "DIA",
    "HT",
    "COND_STATUS_CD",
    "LAT",
    "LON",
    "BALIVE",
    "SICOND",
    "SISP",
    "SIBASE",
    "DSTRBCD1",
    "DSTRBYR1",
    "DSTRBCD2",
    "DSTRBYR2",
    "DSTRBCD3",
    "DSTRBYR3",
    "SDIMAX_RMRS",
    "SDI_RMRS",
    "SLOPE",
    "ASPECT",
    "CONDPROP_UNADJ",
    "RECONCILECD"
  )
)
```

    Joining with `by = join_by(TREE_COMPOSITE_ID, PLOT_COMPOSITE_ID, PLOT, SUBP, STATECD, COUNTYCD)`
    Joining with `by = join_by(TREE_COMPOSITE_ID, SPCD_CORR, TREE_CN, INVYR, STATUSCD, SPCD, CYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CYCLE, SUBCYCLE)`
    Joining with `by = join_by(PLOT_COMPOSITE_ID, PLOT, STATECD, COUNTYCD, PLT_CN, INVYR, UNITCD, CONDID, CYCLE, SUBCYCLE)`

``` r
knitr::kable(head(qa_d_wb_pine, 20))
```

| TREE_COMPOSITE_ID  | PLOT_COMPOSITE_ID | SPCD |  PLOT | SUBP | COUNTYCD | STATECD |       PLT_CN | INVYR | CYCLE | MEASYEAR |      TREE_CN |      COND_CN | CONDID | STATUSCD | STATUSCD_CORR | STATUSCD_FLAG |  DIA |  HT | COND_STATUS_CD |      LAT |       LON |   BALIVE | SICOND | SISP | SIBASE | DSTRBCD1 | DSTRBYR1 | DSTRBCD2 | DSTRBYR2 | DSTRBCD3 | DSTRBYR3 | SDIMAX_RMRS | SDI_RMRS | SLOPE | ASPECT | CONDPROP_UNADJ | RECONCILECD |
|:-------------------|:------------------|-----:|------:|-----:|---------:|--------:|-------------:|------:|------:|---------:|-------------:|-------------:|-------:|---------:|--------------:|:--------------|-----:|----:|---------------:|---------:|----------:|---------:|-------:|-----:|-------:|---------:|---------:|---------:|---------:|---------:|---------:|------------:|---------:|------:|-------:|---------------:|:------------|
| 30_2_9_81970_4_7   | 30_2_9_81970      |  101 | 81970 |    4 |        9 |      30 | 1.887680e+14 |  2017 |     3 |     2017 | 5.113738e+14 | 5.113737e+14 |      1 |        1 |             1 | FALSE         |  1.2 |   8 |              1 | 45.05775 | -109.7938 |  36.7472 |     18 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         670 |  86.6197 |    60 |     55 |           1.00 | 1           |
| 30_2_95_86848_1_8  | 30_2_95_86848     |  101 | 86848 |    1 |       95 |      30 | 1.887697e+14 |  2018 |     3 |     2018 | 6.847506e+14 | 6.847506e+14 |      1 |        2 |             2 | FALSE         | 22.2 |  56 |              1 | 45.28778 | -110.0514 | 203.7686 |     29 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         670 | 294.8564 |    55 |    320 |           1.00 | NA          |
| 30_4_77_94652_2_5  | 30_4_77_94652     |  101 | 94652 |    2 |       77 |      30 | 1.887641e+14 |  2015 |     3 |     2015 | 3.737827e+14 | 3.737827e+14 |      1 |        2 |             2 | FALSE         |   NA |  NA |              1 | 47.17589 | -113.0782 |   0.0000 |     24 |  108 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         470 |   0.0000 |     3 |      0 |           1.00 | NA          |
| 30_5_1_95142_1_2   | 30_5_1_95142      |  101 | 95142 |    1 |        1 |      30 | 1.887672e+14 |  2017 |     3 |     2017 | 5.113407e+14 | 5.113407e+14 |      1 |        1 |             1 | FALSE         | 19.7 |  46 |              1 | 45.21213 | -113.6094 |  62.3529 |     NA |   NA |     NA |        0 |       NA |        0 |       NA |        0 |       NA |         470 | 121.7303 |    54 |    146 |           1.00 | NA          |
| 30_1_47_84528_3_1  | 30_1_47_84528     |  101 | 84528 |    3 |       47 |      30 | 1.887676e+14 |  2017 |     3 |     2017 | 5.113613e+14 | 5.113613e+14 |      1 |        2 |             2 | FALSE         |   NA |  NA |              2 | 48.04375 | -113.8924 |       NA |     NA |   NA |     NA |        0 |       NA |       NA |       NA |       NA |       NA |           0 |       NA |    NA |     NA |           1.00 | NA          |
| 30_5_1_82038_3_9   | 30_5_1_82038      |  101 | 82038 |    3 |        1 |      30 | 1.887691e+14 |  2018 |     3 |     2018 | 6.847608e+14 | 6.847607e+14 |      1 |        1 |             1 | FALSE         |  2.4 |  17 |              1 | 45.36692 | -112.9304 |  86.5219 |     31 |  108 |     50 |       10 |     2009 |       22 |     9999 |        0 |       NA |         700 | 193.3540 |    15 |     80 |           1.00 | NA          |
| 30_4_13_84890_2_6  | 30_4_13_84890     |  101 | 84890 |    2 |       13 |      30 | 1.887695e+14 |  2018 |     3 |     2018 | 6.847419e+14 | 6.847419e+14 |      1 |        1 |             1 | FALSE         |  2.0 |  13 |              1 | 46.93040 | -110.6987 | 131.5137 |     33 |  108 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         700 | 274.7911 |    27 |    139 |           1.00 | NA          |
| 30_5_67_88419_4_11 | 30_5_67_88419     |  101 | 88419 |    4 |       67 |      30 | 1.887695e+14 |  2018 |     3 |     2018 | 6.847428e+14 | 6.847427e+14 |      1 |        1 |             1 | FALSE         |  1.4 |  10 |              1 | 45.01867 | -110.9395 | 123.2359 |     38 |  108 |     50 |       10 |     9999 |       60 |     9999 |        0 |       NA |         700 | 241.2845 |    18 |    132 |           1.00 | 1           |
| 30_5_67_89355_4_5  | 30_5_67_89355     |  101 | 89355 |    4 |       67 |      30 | 1.887695e+14 |  2018 |     3 |     2018 | 6.847434e+14 | 6.847434e+14 |      1 |        2 |             2 | FALSE         |  9.2 |  33 |              1 | 45.14997 | -110.2372 |  65.8098 |     26 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         735 | 144.8983 |    60 |    120 |           1.00 | NA          |
| 30_5_67_91801_2_3  | 30_5_67_91801     |  101 | 91801 |    2 |       67 |      30 | 1.887695e+14 |  2018 |     3 |     2018 | 6.847436e+14 | 6.847436e+14 |      1 |        2 |             2 | FALSE         |   NA |  NA |              1 | 45.01573 | -110.2422 |  46.9005 |     23 |  108 |     50 |       20 |     2009 |        0 |       NA |        0 |       NA |         470 | 102.0375 |     6 |    220 |           1.00 | NA          |
| 30_1_29_82541_3_4  | 30_1_29_82541     |  101 | 82541 |    3 |       29 |      30 | 1.887660e+14 |  2016 |     3 |     2016 | 4.741774e+14 | 4.741773e+14 |      1 |        2 |             2 | FALSE         | 21.4 |  72 |              1 | 48.75771 | -114.5120 | 118.4171 |     34 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         670 | 203.9137 |    12 |     64 |           1.00 | NA          |
| 30_1_29_94260_1_1  | 30_1_29_94260     |  101 | 94260 |    1 |       29 |      30 | 1.887660e+14 |  2016 |     3 |     2016 | 4.741775e+14 | 4.741774e+14 |      1 |        1 |             1 | FALSE         |  6.5 |  28 |              1 | 48.73057 | -114.4147 |  67.9777 |     22 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         735 | 175.4404 |    26 |     68 |           1.00 | NA          |
| 30_1_29_91861_3_5  | 30_1_29_91861     |  101 | 91861 |    3 |       29 |      30 | 1.887644e+14 |  2015 |     3 |     2015 | 3.738034e+14 | 3.738034e+14 |      1 |        2 |             2 | FALSE         |  5.6 |  18 |              1 | 47.87249 | -113.6085 |  12.7408 |     24 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         670 |  23.5056 |    40 |     35 |           1.00 | NA          |
| 30_5_57_87376_4_12 | 30_5_57_87376     |  101 | 87376 |    4 |       57 |      30 | 3.560028e+14 |  2019 |     3 |     2019 | 7.502193e+14 | 7.502192e+14 |      1 |        2 |             2 | FALSE         |  5.8 |  38 |              1 | 44.77127 | -111.7163 | 122.8838 |     34 |  202 |     50 |       12 |     9999 |        0 |       NA |        0 |       NA |         595 | 237.7835 |    45 |     20 |           1.00 | 4           |
| 30_5_57_80129_3_36 | 30_5_57_80129     |  101 | 80129 |    3 |       57 |      30 | 3.560040e+14 |  2019 |     3 |     2019 | 7.502123e+14 | 7.502122e+14 |      1 |        2 |             2 | FALSE         |  1.7 |   7 |              1 | 45.22140 | -111.5513 |  84.7867 |     22 |  108 |     50 |       10 |     2012 |        0 |       NA |        0 |       NA |         470 | 207.8616 |    20 |    250 |           1.00 | 1           |
| 30_5_57_80423_3_3  | 30_5_57_80423     |  101 | 80423 |    3 |       57 |      30 | 3.560040e+14 |  2019 |     3 |     2019 | 7.502125e+14 | 7.502125e+14 |      1 |        1 |             1 | FALSE         |  7.0 |  27 |              1 | 44.78966 | -111.3835 |  51.9082 |     34 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         735 |  93.0250 |    30 |     10 |           1.00 | NA          |
| 30_5_1_85393_2_10  | 30_5_1_85393      |  101 | 85393 |    2 |        1 |      30 | 1.887661e+14 |  2016 |     3 |     2016 | 4.741801e+14 | 4.741800e+14 |      1 |        1 |             1 | FALSE         |  9.6 |  44 |              1 | 45.62468 | -113.1793 | 169.6584 |     35 |  108 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         700 | 330.9576 |    32 |    186 |           1.00 | NA          |
| 30_5_1_88373_2_10  | 30_5_1_88373      |  101 | 88373 |    2 |        1 |      30 | 1.887661e+14 |  2016 |     3 |     2016 | 4.741802e+14 | 4.741802e+14 |      1 |        1 |             1 | FALSE         |  5.8 |  31 |              1 | 45.49432 | -112.9824 | 128.0539 |     43 |   93 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         670 | 235.6346 |    53 |    253 |           1.00 | NA          |
| 30_3_39_90087_4_6  | 30_3_39_90087     |  101 | 90087 |    4 |       39 |      30 | 1.887676e+14 |  2017 |     3 |     2017 | 5.113627e+14 | 5.113626e+14 |      1 |        1 |             1 | FALSE         |  2.1 |  14 |              1 | 46.25628 | -113.1388 |  90.2812 |     41 |  108 |     50 |        0 |       NA |        0 |       NA |        0 |       NA |         700 | 210.4833 |     4 |      0 |           0.75 | NA          |
| 30_4_7_85307_4_3   | 30_4_7_85307      |  101 | 85307 |    4 |        7 |      30 | 3.560031e+14 |  2019 |     3 |     2021 | 9.598674e+14 | 9.598674e+14 |      1 |        0 |             0 | FALSE         |   NA |  NA |              5 | 46.56730 | -111.3662 |       NA |     NA |   NA |     NA |       NA |       NA |       NA |       NA |       NA |       NA |          NA |       NA |    NA |     NA |           1.00 | 9           |

``` r
dbDisconnect(con, shutdown = TRUE)
```
